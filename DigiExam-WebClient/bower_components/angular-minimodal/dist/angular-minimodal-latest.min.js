(function(){angular.module("angular-minimodal",[]).provider("$modal",function(){this.$get=["$http","$q","$controller","$compile","$rootScope","$templateCache",function($http,$q,$controller,$compile,$rootScope,$templateCache){var defaultOptions,getModal;return getModal=function(path){var cacheData,deferred;return deferred=$q.defer(),cacheData=$templateCache.get(path),null!=cacheData&&cacheData.length>0?(deferred.resolve(angular.element(cacheData)),deferred.promise):$http.get(path).then(function(response){if(200!==response.status)throw new Error("$modal could not find path '"+path+"'");return angular.element(response.data)})},defaultOptions={dismissEscape:!0},angular.extend(this,{show:function(options){var deferred,getModalPromise,instance;if(options=angular.extend(defaultOptions,options),null==options)throw new Error("angular-minimodal: No options provided");if("string"!=typeof options.templateUrl)throw new Error("angular-minmodal: Invalid templateUrl");return deferred=$q.defer(),instance={resolve:function(v){return deferred.resolve(v)},reject:function(v){return deferred.reject(v)},result:deferred.promise},getModalPromise=getModal(options.templateUrl),getModalPromise.then(function($modal){var controller,isChrome,locals,modal;return modal=$modal[0],document.body.appendChild(modal),options.controller&&(locals={$scope:options.$scope||$rootScope.$new(),$modalInstance:instance},controller=$controller(options.controller,locals),$modal.data("$ngControllerController",controller),$modal.children().data("$ngControllerController",controller)),$compile($modal)(locals.$scope),options.dismissEscape&&(modal.oncancel=function(){return instance.reject()}),isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,isChrome||dialogPolyfill.registerDialog(modal),null!=modal.showModal&&modal.showModal(),deferred.promise["finally"](function(){return null!=modal.close&&modal.close(),$modal.remove()})}),instance}})}]})}).call(this);var dialogPolyfill=function(){var supportCustomEvent=window.CustomEvent;supportCustomEvent||(supportCustomEvent=function(event,x){x=x||{};var ev=document.createEvent("CustomEvent");return ev.initCustomEvent(event,!!x.bubbles,!!x.cancelable,x.detail||null),ev},supportCustomEvent.prototype=window.Event.prototype);var dialogPolyfill={};dialogPolyfill.reposition=function(element){var scrollTop=document.body.scrollTop||document.documentElement.scrollTop,topValue=scrollTop+(window.innerHeight-element.offsetHeight)/2;element.style.top=Math.max(0,topValue)+"px",element.dialogPolyfillInfo.isTopOverridden=!0},dialogPolyfill.inNodeList=function(nodeList,node){for(var i=0;i<nodeList.length;++i)if(nodeList[i]==node)return!0;return!1},dialogPolyfill.isInlinePositionSetByStylesheet=function(element){for(var i=0;i<document.styleSheets.length;++i){var styleSheet=document.styleSheets[i],cssRules=null;try{cssRules=styleSheet.cssRules}catch(e){}if(cssRules)for(var j=0;j<cssRules.length;++j){var rule=cssRules[j],selectedNodes=null;try{selectedNodes=document.querySelectorAll(rule.selectorText)}catch(e){}if(selectedNodes&&dialogPolyfill.inNodeList(selectedNodes,element)){var cssTop=rule.style.getPropertyValue("top"),cssBottom=rule.style.getPropertyValue("bottom");if(cssTop&&"auto"!=cssTop||cssBottom&&"auto"!=cssBottom)return!0}}}return!1},dialogPolyfill.needsCentering=function(dialog){var computedStyle=window.getComputedStyle(dialog);return"absolute"!=computedStyle.position?!1:"auto"!=dialog.style.top&&""!=dialog.style.top||"auto"!=dialog.style.bottom&&""!=dialog.style.bottom?!1:!dialogPolyfill.isInlinePositionSetByStylesheet(dialog)},dialogPolyfill.showDialog=function(isModal){if(this.open)throw"InvalidStateError: showDialog called on open dialog";if(this.open=!0,this.setAttribute("open","open"),isModal){var first_form_ctrl=null,autofocus=null,findElementToFocus=function(root){if(root.children)for(var i=0;i<root.children.length;i++){var elem=root.children[i];if(null!==first_form_ctrl||elem.disabled||"BUTTON"!=elem.nodeName&&"INPUT"!=elem.nodeName&&"KEYGEN"!=elem.nodeName&&"SELECT"!=elem.nodeName&&"TEXTAREA"!=elem.nodeName||(first_form_ctrl=elem),elem.autofocus)return autofocus=elem,void 0;if(findElementToFocus(elem),null!==autofocus)return}};findElementToFocus(this),null!==autofocus?autofocus.focus():null!==first_form_ctrl&&first_form_ctrl.focus()}dialogPolyfill.needsCentering(this)&&dialogPolyfill.reposition(this),isModal&&(this.dialogPolyfillInfo.modal=!0,dialogPolyfill.dm.pushDialog(this));try{null!==autofocus?autofocus.focus():null!==first_form_ctrl&&first_form_ctrl.focus()}catch(e){}this.style.zoom=1},dialogPolyfill.close=function(retval){if(!this.open&&!window.HTMLDialogElement)throw"InvalidStateError: close called on closed dialog";this.open=!1,this.removeAttribute("open"),"undefined"!=typeof retval&&(this.returnValue=retval),this.dialogPolyfillInfo.isTopOverridden&&(this.style.top="auto"),this.dialogPolyfillInfo.modal&&dialogPolyfill.dm.removeDialog(this);var event;return document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent("close",!0,!0)):event=new Event("close"),this.dispatchEvent(event),this.returnValue},dialogPolyfill.registerDialog=function(element){element.show&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly."),element.addEventListener("dialog_submit",function(e){element.close(e.detail.target.value),e.preventDefault(),e.stopPropagation()}),element.show=dialogPolyfill.showDialog.bind(element,!1),element.showModal=dialogPolyfill.showDialog.bind(element,!0),element.close=dialogPolyfill.close.bind(element),element.dialogPolyfillInfo={}};var TOP_LAYER_ZINDEX=1e5,MAX_PENDING_DIALOGS=1e5;return dialogPolyfill.DialogManager=function(){this.pendingDialogStack=[],this.overlay=document.createElement("div"),this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.position="fixed",this.overlay.style.left="0px",this.overlay.style.top="0px",this.overlay.style.backgroundColor="rgba(0,0,0,0.0)",this.focusPageLast=this.createFocusable(),this.overlay.appendChild(this.focusPageLast),this.overlay.addEventListener("click",function(e){var redirectedEvent=document.createEvent("MouseEvents");redirectedEvent.initMouseEvent(e.type,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),document.body.dispatchEvent(redirectedEvent)}),window.addEventListener("load",function(){for(var forms=document.getElementsByTagName("form"),i=forms.length;i--;)!function(form){"dialog"==form.getAttribute("method")&&form.addEventListener("click",function(e){if("submit"==e.target.type){var event=new supportCustomEvent("dialog_submit",{bubbles:!0,detail:{target:e.target}});this.dispatchEvent(event),e.preventDefault()}})}(forms[i])})},dialogPolyfill.DialogManager.prototype.createFocusable=function(tabIndex){var span=document.createElement("span");return span.tabIndex=tabIndex||0,span.style.opacity=0,span.style.position="static",span},dialogPolyfill.DialogManager.prototype.blockDocument=function(){document.body.contains(this.overlay)||(document.body.appendChild(this.overlay),void 0===this.needsDocumentElementFocus&&(document.documentElement.focus(),this.needsDocumentElementFocus=document.activeElement!=document.documentElement),this.needsDocumentElementFocus&&(document.documentElement.tabIndex=1))},dialogPolyfill.DialogManager.prototype.unblockDocument=function(){document.body.removeChild(this.overlay),this.needsDocumentElementFocus&&(document.documentElement.tabIndex="")},dialogPolyfill.DialogManager.prototype.updateStacking=function(){if(0==this.pendingDialogStack.length)return this.unblockDocument(),void 0;this.blockDocument();for(var zIndex=TOP_LAYER_ZINDEX,i=0;i<this.pendingDialogStack.length;i++){i==this.pendingDialogStack.length-1&&(this.overlay.style.zIndex=zIndex++);var dialog=this.pendingDialogStack[i];dialog.dialogPolyfillInfo.backdrop.style.zIndex=zIndex++,dialog.style.zIndex=zIndex++}},dialogPolyfill.DialogManager.prototype.handleKey=function(event){var dialogCount=this.pendingDialogStack.length;if(0!=dialogCount){var dialog=this.pendingDialogStack[dialogCount-1],pfi=dialog.dialogPolyfillInfo;switch(event.keyCode){case 9:var activeElement=document.activeElement,forward=!event.shiftKey;forward?activeElement==document.documentElement||activeElement==document.body||activeElement==pfi.backdrop?pfi.focusFirst.focus():activeElement==pfi.focusLast&&pfi.focusFirst.focus():activeElement==pfi.focusFirst?pfi.focusLast.focus():activeElement==this.focusPageLast&&pfi.focusLast.focus();break;case 27:event.preventDefault(),event.stopPropagation();var cancelEvent=new supportCustomEvent("cancel",{bubbles:!1,cancelable:!0});dialog.dispatchEvent(cancelEvent)&&dialog.close()}}},dialogPolyfill.DialogManager.prototype.pushDialog=function(dialog){if(this.pendingDialogStack.length>=MAX_PENDING_DIALOGS)throw"Too many modal dialogs";var backdrop=document.createElement("div");backdrop.className="backdrop";var clickEventListener=function(e){var redirectedEvent=document.createEvent("MouseEvents");redirectedEvent.initMouseEvent(e.type,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),dialog.dispatchEvent(redirectedEvent)};backdrop.addEventListener("click",clickEventListener),dialog.parentNode.insertBefore(backdrop,dialog.nextSibling),dialog.dialogPolyfillInfo.backdrop=backdrop,dialog.dialogPolyfillInfo.clickEventListener=clickEventListener,this.pendingDialogStack.push(dialog),this.updateStacking(),dialog.dialogPolyfillInfo.focusFirst=this.createFocusable(),dialog.dialogPolyfillInfo.focusLast=this.createFocusable(),dialog.appendChild(dialog.dialogPolyfillInfo.focusLast),dialog.insertBefore(dialog.dialogPolyfillInfo.focusFirst,dialog.firstChild)},dialogPolyfill.DialogManager.prototype.removeDialog=function(dialog){var index=this.pendingDialogStack.indexOf(dialog);if(-1!=index){this.pendingDialogStack.splice(index,1);var backdrop=dialog.dialogPolyfillInfo.backdrop,clickEventListener=dialog.dialogPolyfillInfo.clickEventListener;backdrop.removeEventListener("click",clickEventListener),backdrop.parentNode.removeChild(backdrop),dialog.dialogPolyfillInfo.backdrop=null,dialog.dialogPolyfillInfo.clickEventListener=null,this.updateStacking(),dialog.removeChild(dialog.dialogPolyfillInfo.focusFirst),dialog.removeChild(dialog.dialogPolyfillInfo.focusLast),dialog.dialogPolyfillInfo.focusFirst=null,dialog.dialogPolyfillInfo.focusLast=null}},dialogPolyfill.dm=new dialogPolyfill.DialogManager,document.addEventListener("keydown",dialogPolyfill.dm.handleKey.bind(dialogPolyfill.dm)),dialogPolyfill}();
//# sourceMappingURL=angular-minimodal-latest.min.js.map